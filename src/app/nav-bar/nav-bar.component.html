<nav class="nav-bar">
  <div class="nav-bar-items">
    <div class="logo">
      <!-- Usa routerLink en lugar de href para navegación interna en Angular -->
      <a routerLink="/">
        <img src="logos/logo.jpeg" alt="logo" />
      </a>
    </div>

    <div class="nav-bar-buttons">

      <!-- Ícono de Carrito con badge (contador) -->
      <button
        mat-icon-button
        [matMenuTriggerFor]="cartMenu"
        (menuOpened)="loadCartItems()"
        matBadge="{{ cartCount }}"
        matBadgeColor="accent"
        matBadgeSize="small"
        matBadgeHidden="{{ cartCount === 0 }}"
      >
        <mat-icon>shopping_cart</mat-icon>
      </button>

      <!-- Overlay con mat-menu que se abre al hacer clic en el ícono -->
      <mat-menu
        #cartMenu="matMenu"
        xPosition="before"
      >
        <div class="mini-cart-container">
          <div *ngIf="cartItems.length > 0; else emptyCart">
            <!-- Mostrar cada producto en el carrito -->
            <div class="mini-cart-item" *ngFor="let item of cartItems">
              <p>{{ item.name }} (x{{ item.quantity }})</p>
              <p>Subtotal: ${{ item.precio * item.quantity }}</p>
            </div>
            <hr />
            <p><strong>Total:</strong> ${{ getCartTotal() }}</p>

            <!-- Botón para ir a la página /carrito -->
            <button mat-button color="primary" [routerLink]="['/carrito']">
              Ir al carrito
            </button>
          </div>

          <!-- Si no hay productos en el carrito, mostramos este mensaje -->
          <ng-template #emptyCart>
            <p>El carrito está vacío</p>
          </ng-template>
        </div>
      </mat-menu>

      <!-- Menú hamburguesa (para pantallas móviles, etc.) -->
      <div class="burger" (click)="toggleMenu()">
        <i [ngClass]="isMenuOpen ? 'fa-solid fa-xmark' : 'fa-solid fa-bars'"></i>
      </div>
      <div class="nav-bar-links" [class.is-open]="isMenuOpen">
        <a routerLink="/" (click)="closeMenu()">Inicio</a>
        <a routerLink="/productos" (click)="closeMenu()">Productos</a>
        <a routerLink="/como-lo-hacemos" (click)="closeMenu()">Como lo hacemos</a>
        <a routerLink="/contacto" (click)="closeMenu()">Contacto</a>
      </div>
    </div>
  </div>
</nav>
